import{d as B,u as C,r as u,k as S,l as E,E as N,c as d,a as n,e as f,F as V,z as I,y as m,t as b,q as j,v as $,x as z,o as g,G as D}from"./index-Cwj_Fd2k.js";import{_ as F}from"./MappingEditor.vue_vue_type_script_setup_true_lang-DSsuwDKl.js";const U={class:"grid gap-8 lg:grid-cols-[320px_minmax(0,1fr)]"},q={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},A={class:"mt-4 space-y-2"},G=["onClick"],H={class:"mt-6"},J={key:0,class:"mt-4 text-sm text-slate-500"},L={key:1,class:"mt-2 text-sm font-medium text-rose-600"},O={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},T={class:"mt-4 space-y-4"},W={class:"flex justify-end"},K=["disabled"],X=B({__name:"SettingsBankSchemasView",setup(P){const i=C(),_=u(null),r=u(""),s=u(""),t=S({booking_date:[],booking_text:[],booking_type:[],booking_amount:[],booking_date_parse_format:""}),x=E(()=>{const a=new Set;return i.mappings.forEach(e=>{e.booking_date.forEach(o=>a.add(o)),e.booking_text.forEach(o=>a.add(o)),e.booking_type.forEach(o=>a.add(o)),e.booking_amount.forEach(o=>a.add(o))}),Array.from(a)});function c(a){const e=i.mappingByBank(a);e&&(s.value=e.bank_name,t.booking_date=[...e.booking_date],t.booking_text=[...e.booking_text],t.booking_type=[...e.booking_type],t.booking_amount=[...e.booking_amount],t.booking_date_parse_format=e.booking_date_parse_format)}function v(){s.value="",t.booking_date=[],t.booking_text=[],t.booking_type=[],t.booking_amount=[],t.booking_date_parse_format=""}async function y(){s.value&&(await i.save({bank_name:s.value,booking_date:[...t.booking_date],booking_text:[...t.booking_text],booking_type:[...t.booking_type],booking_amount:[...t.booking_amount],booking_date_parse_format:t.booking_date_parse_format}),r.value=`Mapping für ${s.value} gespeichert.`)}async function h(a){var k;const e=a.target,o=(k=e.files)==null?void 0:k[0];if(!o)return;const l=await o.text();try{const p=JSON.parse(l),M=await i.importMappings(p);r.value=M?"Mappings importiert.":"Import fehlgeschlagen."}catch(p){console.error("Import failed",p),r.value="Datei konnte nicht gelesen werden."}finally{e.value=""}}function w(a){t.booking_date=[...a.booking_date],t.booking_text=[...a.booking_text],t.booking_type=[...a.booking_type],t.booking_amount=[...a.booking_amount],t.booking_date_parse_format=a.booking_date_parse_format}return N(()=>{i.mappings.length>0&&!s.value&&c(i.mappings[0].bank_name)}),(a,e)=>(g(),d("div",U,[n("aside",q,[n("div",{class:"flex items-center justify-between"},[e[2]||(e[2]=n("h2",{class:"text-lg font-semibold text-slate-900"},"Bank-Mappings",-1)),n("button",{type:"button",class:"text-sm font-medium text-indigo-600 hover:text-indigo-500",onClick:v}," Neu ")]),e[3]||(e[3]=n("p",{class:"mt-2 text-sm text-slate-600"}," Wählen Sie eine Bank aus, um das vorhandene Mapping anzupassen. ",-1)),n("ul",A,[(g(!0),d(V,null,I(m(i).mappings,o=>(g(),d("li",{key:o.bank_name},[n("button",{type:"button",class:D(["w-full rounded-lg px-3 py-2 text-left text-sm font-medium",s.value===o.bank_name?"bg-indigo-100 text-indigo-700":"bg-slate-100 text-slate-700 hover:bg-slate-200"]),onClick:l=>c(o.bank_name)},b(o.bank_name),11,G)]))),128))]),n("div",H,[n("input",{ref_key:"importInput",ref:_,type:"file",accept:"application/json",class:"hidden",onChange:h},null,544),n("button",{type:"button",class:"inline-flex items-center rounded-lg border border-indigo-200 px-3 py-2 text-xs font-semibold text-indigo-600 hover:bg-indigo-50",onClick:e[0]||(e[0]=o=>{var l;return(l=_.value)==null?void 0:l.click()})}," Mappings importieren ")]),r.value?(g(),d("p",J,b(r.value),1)):f("",!0),m(i).error?(g(),d("p",L,b(m(i).error),1)):f("",!0)]),n("section",O,[e[5]||(e[5]=n("h2",{class:"text-lg font-semibold text-slate-900"},"Mapping bearbeiten",-1)),n("div",T,[n("div",null,[e[4]||(e[4]=n("label",{for:"bank-name",class:"block text-sm font-medium text-slate-700"},"Bankname",-1)),$(n("input",{id:"bank-name","onUpdate:modelValue":e[1]||(e[1]=o=>s.value=o),type:"text",class:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[z,s.value]])]),j(F,{headers:x.value,"model-value":t,"onUpdate:modelValue":w},null,8,["headers","model-value"]),n("div",W,[n("button",{type:"button",class:"inline-flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-500",disabled:!s.value,onClick:y}," Speichern ",8,K)])])])]))}});export{X as default};
