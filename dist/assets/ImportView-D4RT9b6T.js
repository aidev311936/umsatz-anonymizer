import{d as Se,r as be,c as se,a as y,t as ce,o as te,b as ze,w as Ne,T as je,e as pe,f as Pe,n as Ue,D as Ve,p as $e,g as qe,s as He,h as Ke,u as We,i as Ze,j as Qe,k as Je,l as De,m as Ae,q as we,v as Oe,x as Te,y as W,F as Ge,z as Ye,A as Xe}from"./index-Cwj_Fd2k.js";import{_ as et}from"./MappingEditor.vue_vue_type_script_setup_true_lang-DSsuwDKl.js";import{_ as tt}from"./TransactionImportsPanel.vue_vue_type_script_setup_true_lang-1ktQEVow.js";const nt=["for"],it={class:"mt-2 flex items-center gap-4"},rt=["id","accept"],st={class:"text-sm text-slate-600"},at=Se({__name:"FileUpload",props:{label:{default:"CSV-Datei"},accept:{default:".csv,text/csv"},id:{default:"file-upload"}},emits:["file-selected"],setup(r,{emit:i}){const d=i,u=be(null),I=be("");function S(L){var o;const x=(o=L.target.files)==null?void 0:o[0];x&&(I.value=x.name,d("file-selected",x))}return(L,v)=>(te(),se("div",null,[y("label",{for:r.id,class:"block text-sm font-medium text-slate-700"},ce(r.label),9,nt),y("div",it,[y("input",{id:r.id,ref_key:"inputRef",ref:u,type:"file",class:"hidden",accept:r.accept,onChange:S},null,40,rt),y("button",{type:"button",class:"inline-flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-500",onClick:v[0]||(v[0]=x=>{var o;return(o=u.value)==null?void 0:o.click()})}," Datei wählen "),y("span",st,ce(I.value||"Keine Datei ausgewählt"),1)])]))}}),ot={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 px-4"},lt={class:"w-full max-w-md rounded-2xl bg-white p-6 shadow-2xl"},ut={class:"mt-2 text-sm text-slate-600"},dt={class:"mt-6"},ct={class:"h-2 rounded-full bg-slate-200"},ht={class:"mt-2 text-xs text-slate-500"},ft=Se({__name:"ImportProgressDialog",props:{visible:{type:Boolean},progress:{default:0},message:{default:"Die CSV-Datei wird verarbeitet…"}},setup(r){return(i,d)=>(te(),ze(je,{"enter-active-class":"transition duration-200","enter-from-class":"opacity-0","leave-active-class":"transition duration-150","leave-to-class":"opacity-0"},{default:Ne(()=>[r.visible?(te(),se("div",ot,[y("div",lt,[d[0]||(d[0]=y("h3",{class:"text-lg font-semibold text-slate-900"},"Import läuft",-1)),y("p",ut,ce(r.message),1),y("div",dt,[y("div",ct,[y("div",{class:"h-2 rounded-full bg-indigo-500 transition-all",style:Ue({width:`${r.progress}%`})},null,4)]),y("p",ht,ce(r.progress.toFixed(0))+" % abgeschlossen",1)]),Pe(i.$slots,"default")])])):pe("",!0)]),_:3}))}});var pt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Me={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(r,i){((d,u)=>{r.exports=u()})(pt,function d(){var u=typeof self<"u"?self:typeof window<"u"?window:u!==void 0?u:{},I,S=!u.document&&!!u.postMessage,L=u.IS_PAPA_WORKER||!1,v={},x=0,o={};function z(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var n=K(t);n.chunkSize=parseInt(n.chunkSize),t.step||t.chunk||(n.chunkSize=null),this._handle=new R(n),(this._handle.streamer=this)._config=n}).call(this,e),this.parseChunk=function(t,n){var a=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<a){let g=this._config.newline;g||(s=this._config.quoteChar||'"',g=this._handle.guessLineEndings(t,s)),t=[...t.split(g).slice(a)].join(g)}this.isFirstChunk&&D(this._config.beforeFirstChunk)&&(s=this._config.beforeFirstChunk(t))!==void 0&&(t=s),this.isFirstChunk=!1,this._halted=!1;var a=this._partialLine+t,s=(this._partialLine="",this._handle.parse(a,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=s.meta.cursor,a=(this._finished||(this._partialLine=a.substring(t-this._baseIndex),this._baseIndex=t),s&&s.data&&(this._rowCount+=s.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),L)u.postMessage({results:s,workerId:o.WORKER_ID,finished:a});else if(D(this._config.chunk)&&!n){if(this._config.chunk(s,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=s=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(s.data),this._completeResults.errors=this._completeResults.errors.concat(s.errors),this._completeResults.meta=s.meta),this._completed||!a||!D(this._config.complete)||s&&s.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),a||s&&s.meta.paused||this._nextChunk(),s}this._halted=!0},this._sendError=function(t){D(this._config.error)?this._config.error(t):L&&this._config.error&&u.postMessage({workerId:o.WORKER_ID,error:t,finished:!1})}}function Q(e){var t;(e=e||{}).chunkSize||(e.chunkSize=o.RemoteChunkSize),z.call(this,e),this._nextChunk=S?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(n){this._input=n,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),S||(t.onload=X(this._chunkLoaded,this),t.onerror=X(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!S),this._config.downloadRequestHeaders){var n,a=this._config.downloadRequestHeaders;for(n in a)t.setRequestHeader(n,a[n])}var s;this._config.chunkSize&&(s=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+s));try{t.send(this._config.downloadRequestBody)}catch(g){this._chunkError(g.message)}S&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(n=>(n=n.getResponseHeader("Content-Range"))!==null?parseInt(n.substring(n.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(n){n=t.statusText||n,this._sendError(new Error(n))}}function le(e){(e=e||{}).chunkSize||(e.chunkSize=o.LocalChunkSize),z.call(this,e);var t,n,a=typeof FileReader<"u";this.stream=function(s){this._input=s,n=s.slice||s.webkitSlice||s.mozSlice,a?((t=new FileReader).onload=X(this._chunkLoaded,this),t.onerror=X(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var s=this._input,g=(this._config.chunkSize&&(g=Math.min(this._start+this._config.chunkSize,this._input.size),s=n.call(s,this._start,g)),t.readAsText(s,this._config.encoding));a||this._chunkLoaded({target:{result:g}})},this._chunkLoaded=function(s){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(s.target.result)},this._chunkError=function(){this._sendError(t.error)}}function ae(e){var t;z.call(this,e=e||{}),this.stream=function(n){return t=n,this._nextChunk()},this._nextChunk=function(){var n,a;if(!this._finished)return n=this._config.chunkSize,t=n?(a=t.substring(0,n),t.substring(n)):(a=t,""),this._finished=!t,this.parseChunk(a)}}function ue(e){z.call(this,e=e||{});var t=[],n=!0,a=!1;this.pause=function(){z.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){z.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(s){this._input=s,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){a&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=X(function(s){try{t.push(typeof s=="string"?s:s.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(g){this._streamError(g)}},this),this._streamError=X(function(s){this._streamCleanUp(),this._sendError(s)},this),this._streamEnd=X(function(){this._streamCleanUp(),a=!0,this._streamData("")},this),this._streamCleanUp=X(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function R(e){var t,n,a,s,g=Math.pow(2,53),N=-g,J=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,G=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,m=this,T=0,c=0,$=!1,f=!1,_=[],l={data:[],errors:[],meta:{}};function j(k){return e.skipEmptyLines==="greedy"?k.join("").trim()==="":k.length===1&&k[0].length===0}function M(){if(l&&a&&(Y("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),a=!1),e.skipEmptyLines&&(l.data=l.data.filter(function(h){return!j(h)})),V()){let h=function(B,P){D(e.transformHeader)&&(B=e.transformHeader(B,P)),_.push(B)};if(l)if(Array.isArray(l.data[0])){for(var k=0;V()&&k<l.data.length;k++)l.data[k].forEach(h);l.data.splice(0,1)}else l.data.forEach(h)}function E(h,B){for(var P=e.header?{}:[],C=0;C<h.length;C++){var A=C,b=h[C],b=((ee,p)=>(O=>(e.dynamicTypingFunction&&e.dynamicTyping[O]===void 0&&(e.dynamicTyping[O]=e.dynamicTypingFunction(O)),(e.dynamicTyping[O]||e.dynamicTyping)===!0))(ee)?p==="true"||p==="TRUE"||p!=="false"&&p!=="FALSE"&&((O=>{if(J.test(O)&&(O=parseFloat(O),N<O&&O<g))return 1})(p)?parseFloat(p):G.test(p)?new Date(p):p===""?null:p):p)(A=e.header?C>=_.length?"__parsed_extra":_[C]:A,b=e.transform?e.transform(b,A):b);A==="__parsed_extra"?(P[A]=P[A]||[],P[A].push(b)):P[A]=b}return e.header&&(C>_.length?Y("FieldMismatch","TooManyFields","Too many fields: expected "+_.length+" fields but parsed "+C,c+B):C<_.length&&Y("FieldMismatch","TooFewFields","Too few fields: expected "+_.length+" fields but parsed "+C,c+B)),P}var F;l&&(e.header||e.dynamicTyping||e.transform)&&(F=1,!l.data.length||Array.isArray(l.data[0])?(l.data=l.data.map(E),F=l.data.length):l.data=E(l.data,0),e.header&&l.meta&&(l.meta.fields=_),c+=F)}function V(){return e.header&&_.length===0}function Y(k,E,F,h){k={type:k,code:E,message:F},h!==void 0&&(k.row=h),l.errors.push(k)}D(e.step)&&(s=e.step,e.step=function(k){l=k,V()?M():(M(),l.data.length!==0&&(T+=k.data.length,e.preview&&T>e.preview?n.abort():(l.data=l.data[0],s(l,m))))}),this.parse=function(k,E,F){var h=e.quoteChar||'"',h=(e.newline||(e.newline=this.guessLineEndings(k,h)),a=!1,e.delimiter?D(e.delimiter)&&(e.delimiter=e.delimiter(k),l.meta.delimiter=e.delimiter):((h=((B,P,C,A,b)=>{var ee,p,O,de;b=b||[",","	","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var he=0;he<b.length;he++){for(var ne,_e=b[he],q=0,ie=0,U=0,Z=(O=void 0,new H({comments:A,delimiter:_e,newline:P,preview:10}).parse(B)),oe=0;oe<Z.data.length;oe++)C&&j(Z.data[oe])?U++:(ne=Z.data[oe].length,ie+=ne,O===void 0?O=ne:0<ne&&(q+=Math.abs(ne-O),O=ne));0<Z.data.length&&(ie/=Z.data.length-U),(p===void 0||q<=p)&&(de===void 0||de<ie)&&1.99<ie&&(p=q,ee=_e,de=ie)}return{successful:!!(e.delimiter=ee),bestDelimiter:ee}})(k,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=h.bestDelimiter:(a=!0,e.delimiter=o.DefaultDelimiter),l.meta.delimiter=e.delimiter),K(e));return e.preview&&e.header&&h.preview++,t=k,n=new H(h),l=n.parse(t,E,F),M(),$?{meta:{paused:!0}}:l||{meta:{paused:!1}}},this.paused=function(){return $},this.pause=function(){$=!0,n.abort(),t=D(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){m.streamer._halted?($=!1,m.streamer.parseChunk(t,!0)):setTimeout(m.resume,3)},this.aborted=function(){return f},this.abort=function(){f=!0,n.abort(),l.meta.aborted=!0,D(e.complete)&&e.complete(l),t=""},this.guessLineEndings=function(B,h){B=B.substring(0,1048576);var h=new RegExp(w(h)+"([^]*?)"+w(h),"gm"),F=(B=B.replace(h,"")).split("\r"),h=B.split(`
`),B=1<h.length&&h[0].length<F[0].length;if(F.length===1||B)return`
`;for(var P=0,C=0;C<F.length;C++)F[C][0]===`
`&&P++;return P>=F.length/2?`\r
`:"\r"}}function w(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function H(e){var t=(e=e||{}).delimiter,n=e.newline,a=e.comments,s=e.step,g=e.preview,N=e.fastMode,J=null,G=!1,m=e.quoteChar==null?'"':e.quoteChar,T=m;if(e.escapeChar!==void 0&&(T=e.escapeChar),(typeof t!="string"||-1<o.BAD_DELIMITERS.indexOf(t))&&(t=","),a===t)throw new Error("Comment character same as delimiter");a===!0?a="#":(typeof a!="string"||-1<o.BAD_DELIMITERS.indexOf(a))&&(a=!1),n!==`
`&&n!=="\r"&&n!==`\r
`&&(n=`
`);var c=0,$=!1;this.parse=function(f,_,l){if(typeof f!="string")throw new Error("Input must be a string");var j=f.length,M=t.length,V=n.length,Y=a.length,k=D(s),E=[],F=[],h=[],B=c=0;if(!f)return q();if(N||N!==!1&&f.indexOf(m)===-1){for(var P=f.split(n),C=0;C<P.length;C++){if(h=P[C],c+=h.length,C!==P.length-1)c+=n.length;else if(l)return q();if(!a||h.substring(0,Y)!==a){if(k){if(E=[],de(h.split(t)),ie(),$)return q()}else de(h.split(t));if(g&&g<=C)return E=E.slice(0,g),q(!0)}}return q()}for(var A=f.indexOf(t,c),b=f.indexOf(n,c),ee=new RegExp(w(T)+w(m),"g"),p=f.indexOf(m,c);;)if(f[c]===m)for(p=c,c++;;){if((p=f.indexOf(m,p+1))===-1)return l||F.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:E.length,index:c}),ne();if(p===j-1)return ne(f.substring(c,p).replace(ee,m));if(m===T&&f[p+1]===T)p++;else if(m===T||p===0||f[p-1]!==T){A!==-1&&A<p+1&&(A=f.indexOf(t,p+1));var O=he((b=b!==-1&&b<p+1?f.indexOf(n,p+1):b)===-1?A:Math.min(A,b));if(f.substr(p+1+O,M)===t){h.push(f.substring(c,p).replace(ee,m)),f[c=p+1+O+M]!==m&&(p=f.indexOf(m,c)),A=f.indexOf(t,c),b=f.indexOf(n,c);break}if(O=he(b),f.substring(p+1+O,p+1+O+V)===n){if(h.push(f.substring(c,p).replace(ee,m)),_e(p+1+O+V),A=f.indexOf(t,c),p=f.indexOf(m,c),k&&(ie(),$))return q();if(g&&E.length>=g)return q(!0);break}F.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:E.length,index:c}),p++}}else if(a&&h.length===0&&f.substring(c,c+Y)===a){if(b===-1)return q();c=b+V,b=f.indexOf(n,c),A=f.indexOf(t,c)}else if(A!==-1&&(A<b||b===-1))h.push(f.substring(c,A)),c=A+M,A=f.indexOf(t,c);else{if(b===-1)break;if(h.push(f.substring(c,b)),_e(b+V),k&&(ie(),$))return q();if(g&&E.length>=g)return q(!0)}return ne();function de(U){E.push(U),B=c}function he(U){var Z=0;return Z=U!==-1&&(U=f.substring(p+1,U))&&U.trim()===""?U.length:Z}function ne(U){return l||(U===void 0&&(U=f.substring(c)),h.push(U),c=j,de(h),k&&ie()),q()}function _e(U){c=U,de(h),h=[],b=f.indexOf(n,c)}function q(U){if(e.header&&!_&&E.length&&!G){var Z=E[0],oe=Object.create(null),Ee=new Set(Z);let Ce=!1;for(let fe=0;fe<Z.length;fe++){let re=Z[fe];if(oe[re=D(e.transformHeader)?e.transformHeader(re,fe):re]){let ke,Ie=oe[re];for(;ke=re+"_"+Ie,Ie++,Ee.has(ke););Ee.add(ke),Z[fe]=ke,oe[re]++,Ce=!0,(J=J===null?{}:J)[ke]=re}else oe[re]=1,Z[fe]=re;Ee.add(re)}Ce&&console.warn("Duplicate headers found and renamed."),G=!0}return{data:E,errors:F,meta:{delimiter:t,linebreak:n,aborted:$,truncated:!!U,cursor:B+(_||0),renamedHeaders:J}}}function ie(){s(q()),E=[],F=[]}},this.abort=function(){$=!0},this.getCharIndex=function(){return c}}function ye(e){var t=e.data,n=v[t.workerId],a=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var s={abort:function(){a=!0,ge(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:me,resume:me};if(D(n.userStep)){for(var g=0;g<t.results.data.length&&(n.userStep({data:t.results.data[g],errors:t.results.errors,meta:t.results.meta},s),!a);g++);delete t.results}else D(n.userChunk)&&(n.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!a&&ge(t.workerId,t.results)}function ge(e,t){var n=v[e];D(n.userComplete)&&n.userComplete(t),n.terminate(),delete v[e]}function me(){throw new Error("Not implemented.")}function K(e){if(typeof e!="object"||e===null)return e;var t,n=Array.isArray(e)?[]:{};for(t in e)n[t]=K(e[t]);return n}function X(e,t){return function(){e.apply(t,arguments)}}function D(e){return typeof e=="function"}return o.parse=function(e,t){var n=(t=t||{}).dynamicTyping||!1;if(D(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=!!D(t.transform)&&t.transform,!t.worker||!o.WORKERS_SUPPORTED)return n=null,o.NODE_STREAM_INPUT,typeof e=="string"?(e=(a=>a.charCodeAt(0)!==65279?a:a.slice(1))(e),n=new(t.download?Q:ae)(t)):e.readable===!0&&D(e.read)&&D(e.on)?n=new ue(t):(u.File&&e instanceof File||e instanceof Object)&&(n=new le(t)),n.stream(e);(n=(()=>{var a;return!!o.WORKERS_SUPPORTED&&(a=(()=>{var s=u.URL||u.webkitURL||null,g=d.toString();return o.BLOB_URL||(o.BLOB_URL=s.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",g,")();"],{type:"text/javascript"})))})(),(a=new u.Worker(a)).onmessage=ye,a.id=x++,v[a.id]=a)})()).userStep=t.step,n.userChunk=t.chunk,n.userComplete=t.complete,n.userError=t.error,t.step=D(t.step),t.chunk=D(t.chunk),t.complete=D(t.complete),t.error=D(t.error),delete t.worker,n.postMessage({input:e,config:t,workerId:n.id})},o.unparse=function(e,t){var n=!1,a=!0,s=",",g=`\r
`,N='"',J=N+N,G=!1,m=null,T=!1,c=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||o.BAD_DELIMITERS.filter(function(_){return t.delimiter.indexOf(_)!==-1}).length||(s=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(n=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(G=t.skipEmptyLines),typeof t.newline=="string"&&(g=t.newline),typeof t.quoteChar=="string"&&(N=t.quoteChar),typeof t.header=="boolean"&&(a=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");m=t.columns}t.escapeChar!==void 0&&(J=t.escapeChar+N),t.escapeFormulae instanceof RegExp?T=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(T=/^[=+\-@\t\r].*$/)}})(),new RegExp(w(N),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return $(null,e,G);if(typeof e[0]=="object")return $(m||Object.keys(e[0]),e,G)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||m),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),$(e.fields||[],e.data||[],G);throw new Error("Unable to serialize unrecognized input");function $(_,l,j){var M="",V=(typeof _=="string"&&(_=JSON.parse(_)),typeof l=="string"&&(l=JSON.parse(l)),Array.isArray(_)&&0<_.length),Y=!Array.isArray(l[0]);if(V&&a){for(var k=0;k<_.length;k++)0<k&&(M+=s),M+=f(_[k],k);0<l.length&&(M+=g)}for(var E=0;E<l.length;E++){var F=(V?_:l[E]).length,h=!1,B=V?Object.keys(l[E]).length===0:l[E].length===0;if(j&&!V&&(h=j==="greedy"?l[E].join("").trim()==="":l[E].length===1&&l[E][0].length===0),j==="greedy"&&V){for(var P=[],C=0;C<F;C++){var A=Y?_[C]:C;P.push(l[E][A])}h=P.join("").trim()===""}if(!h){for(var b=0;b<F;b++){0<b&&!B&&(M+=s);var ee=V&&Y?_[b]:b;M+=f(l[E][ee],b)}E<l.length-1&&(!j||0<F&&!B)&&(M+=g)}}return M}function f(_,l){var j,M;return _==null?"":_.constructor===Date?JSON.stringify(_).slice(1,25):(M=!1,T&&typeof _=="string"&&T.test(_)&&(_="'"+_,M=!0),j=_.toString().replace(c,J),(M=M||n===!0||typeof n=="function"&&n(_,l)||Array.isArray(n)&&n[l]||((V,Y)=>{for(var k=0;k<Y.length;k++)if(-1<V.indexOf(Y[k]))return!0;return!1})(j,o.BAD_DELIMITERS)||-1<j.indexOf(s)||j.charAt(0)===" "||j.charAt(j.length-1)===" ")?N+j+N:j)}},o.RECORD_SEP="",o.UNIT_SEP="",o.BYTE_ORDER_MARK="\uFEFF",o.BAD_DELIMITERS=["\r",`
`,'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!S&&!!u.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=H,o.ParserHandle=R,o.NetworkStreamer=Q,o.FileStreamer=le,o.StringStreamer=ae,o.ReadableStreamStreamer=ue,u.jQuery&&((I=u.jQuery).fn.parse=function(e){var t=e.config||{},n=[];return this.each(function(g){if(!(I(this).prop("tagName").toUpperCase()==="INPUT"&&I(this).attr("type").toLowerCase()==="file"&&u.FileReader)||!this.files||this.files.length===0)return!0;for(var N=0;N<this.files.length;N++)n.push({file:this.files[N],inputElem:this,instanceConfig:I.extend({},t)})}),a(),this;function a(){if(n.length===0)D(e.complete)&&e.complete();else{var g,N,J,G,m=n[0];if(D(e.before)){var T=e.before(m.file,m.inputElem);if(typeof T=="object"){if(T.action==="abort")return g="AbortError",N=m.file,J=m.inputElem,G=T.reason,void(D(e.error)&&e.error({name:g},N,J,G));if(T.action==="skip")return void s();typeof T.config=="object"&&(m.instanceConfig=I.extend(m.instanceConfig,T.config))}else if(T==="skip")return void s()}var c=m.instanceConfig.complete;m.instanceConfig.complete=function($){D(c)&&c($,m.file,m.inputElem),s()},o.parse(m.file,m.instanceConfig)}}function s(){n.splice(0,1),a()}}),L&&(u.onmessage=function(e){e=e.data,o.WORKER_ID===void 0&&e&&(o.WORKER_ID=e.workerId),typeof e.input=="string"?u.postMessage({workerId:o.WORKER_ID,results:o.parse(e.input,e.config),finished:!0}):(u.File&&e.input instanceof File||e.input instanceof Object)&&(e=o.parse(e.input,e.config))&&u.postMessage({workerId:o.WORKER_ID,results:e,finished:!0})}),(Q.prototype=Object.create(z.prototype)).constructor=Q,(le.prototype=Object.create(z.prototype)).constructor=le,(ae.prototype=Object.create(ae.prototype)).constructor=ae,(ue.prototype=Object.create(z.prototype)).constructor=ue,o})})(Me);var mt=Me.exports;const _t=gt(mt);function kt(r){return typeof r=="string"?r.replace(/\uFEFF/g,"").trim():r==null?"":String(r).trim()}function bt(r){return new Promise((i,d)=>{const u=new FileReader;u.onerror=()=>{d(u.error??new Error("Datei konnte nicht gelesen werden"))},u.onload=()=>{const I=typeof u.result=="string"?u.result:new TextDecoder("utf-8").decode(u.result);try{_t.parse(I,{delimiter:"",skipEmptyLines:!1,transform:S=>typeof S=="string"?S.trim():S,complete:S=>{const L=S.data.filter(v=>Array.isArray(v)).map(v=>v.map(x=>kt(x)));i(L)},error:S=>{d(S)}})}catch(S){d(S instanceof Error?S:new Error("Fehler beim CSV-Parsing"))}},u.readAsText(r,"utf-8")})}const Fe=["Buchungstag","Wertstellung (Valuta)","Vorgang","Buchungstext","Umsatz in EUR"],Be=["Datum","Betrag","Verwendungszweck","Zahlungspartner","Type"];function yt(r){return r.map(i=>i.replace(/\uFEFF/g,"").trim())}function ve(r){return r.every(i=>i.trim()==="")}function Le(r,i){return r.length<i.length?!1:i.every((d,u)=>{var I;return((I=r[u])==null?void 0:I.toLowerCase())===d.toLowerCase()})}function wt(r){const i=r.map(yt),d=i.findIndex(v=>Le(v,Fe));if(d>=0){const v=i.slice(d+1).filter(x=>!ve(x));return{header:i[d].slice(0,Fe.length),dataRows:v,detectedBank:"comdirect",skippedRows:d}}const u=i.findIndex(v=>Le(v,Be));if(u>=0){const v=i.slice(u+1).filter(x=>!ve(x));return{header:i[u].slice(0,Be.length),dataRows:v,detectedBank:"PayCenter",skippedRows:u}}const I=i.findIndex(v=>!ve(v));if(I===-1)return{header:[],dataRows:[],skippedRows:i.length,warning:"Keine Headerzeile erkannt. Bitte CSV prüfen."};const S=i[I],L=i.slice(I+1).filter(v=>!ve(v));return{header:S,dataRows:L,skippedRows:I,warning:"Unbekannte Kopfzeile erkannt. Bitte Zuordnung prüfen."}}function vt(r){const i={};return r.forEach((d,u)=>{d in i||(i[d]=u)}),i}function xe(r,i,d){const u=d[i];return u===void 0?"":(r[u]??"").toString().trim()}function Re(r){for(const i of r){const d=i.trim();if(d.length>0)return d}return""}function xt(r){return r.map(i=>i.trim()).filter(i=>i.length>0).join(" ")}function Et(r){return r.booking_date.trim()===""&&r.booking_text.trim()===""&&r.booking_type.trim()===""&&r.booking_amount.trim()===""}function Rt(r,i,d,u,I,S){var x,o;const L=vt(i),v=[];for(const z of r){const Q=Re(d.booking_date.map(K=>xe(z,K,L))),le=xt(d.booking_text.map(K=>xe(z,K,L))),ae=Re(d.booking_type.map(K=>xe(z,K,L))),ue=Re(d.booking_amount.map(K=>xe(z,K,L))),R=((x=d.booking_date_parse_format)==null?void 0:x.trim())??"",w=((o=S.booking_date_display_format)==null?void 0:o.trim())??"",H=w.length>0?w:Ve;let ye=Q,ge=null;if(R&&Q.length>0){const K=$e(Q,R);if(K){ge=K.toISOString();const X=H.length>0?H:R;ye=X?qe(K,X):Q}}const me={bank_name:u,booking_date:ye,booking_date_raw:Q,booking_date_iso:ge,booking_text:le,booking_type:ae,booking_amount:ue,booking_account:I};Et(me)||v.push(me)}return v}async function St(r){return bt(r)}function Ct(r){return wt(r)}function It(r,i,d,u,I){const S=He(I??null);return Rt(r,i,d,u.bankName,u.bookingAccount,S)}function Dt(r){return{booking_date:r.length>0?[r[0]]:[],booking_text:r.slice(1,2),booking_type:r.slice(2,3),booking_amount:r.slice(3,4),booking_date_parse_format:""}}const At=Ke("import",{state:()=>({bankName:"",bookingAccount:"",header:[],dataRows:[],mapping:null,detectedBank:null,skippedRows:0,warning:null,loading:!1,error:null,lastImported:[]}),getters:{hasHeader(r){return r.header.length>0}},actions:{setBankName(r){this.bankName=r.trim()},setBookingAccount(r){this.bookingAccount=r.trim()},setMapping(r){this.mapping={...r}},reset(){this.header=[],this.dataRows=[],this.mapping=null,this.detectedBank=null,this.skippedRows=0,this.warning=null,this.lastImported=[],this.error=null},async loadFile(r){this.loading=!0,this.error=null;try{const i=await St(r),d=Ct(i);this.header=d.header,this.dataRows=d.dataRows,this.detectedBank=d.detectedBank??null,this.skippedRows=d.skippedRows,this.warning=d.warning??null,(!this.mapping||this.mapping.booking_date.length===0)&&(this.mapping=Dt(d.header))}catch(i){this.error=i instanceof Error?i.message:"CSV konnte nicht geladen werden",this.reset()}finally{this.loading=!1}},importTransactions(r){if(!this.mapping||this.header.length===0)return this.error="Bitte Mapping und Kopfzeile prüfen",[];const i=It(this.dataRows,this.header,this.mapping,{bankName:this.bankName,bookingAccount:this.bookingAccount},r);return this.lastImported=i,i}}}),Ot={class:"space-y-8"},Tt={class:"grid gap-6 lg:grid-cols-3"},Ft={class:"lg:col-span-2 space-y-6"},Bt={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},Lt={class:"mt-6 space-y-4"},Mt={id:"knownBanks"},zt=["value"],Nt={key:0,class:"text-sm text-slate-500"},jt={class:"font-medium"},Pt={key:1,class:"text-sm font-medium text-amber-600"},Ut={key:2,class:"text-sm font-medium text-rose-600"},Vt={key:0,class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},$t={class:"mt-6"},qt={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},Ht={class:"flex flex-wrap items-center gap-4"},Kt=["disabled"],Wt={key:0,class:"text-sm text-slate-600"},Gt=Se({__name:"ImportView",setup(r){const i=At(),d=We(),u=Ze(),I=Qe(),S=be(!1),L=be(0),v=be(""),x=Je({value:i.mapping});function o(){if(x.value)return x.value;if(i.mapping)return x.value={...i.mapping},x.value;const R=d.mappingByBank(i.bankName);return R?(x.value={booking_date:[...R.booking_date],booking_text:[...R.booking_text],booking_type:[...R.booking_type],booking_amount:[...R.booking_amount],booking_date_parse_format:R.booking_date_parse_format},x.value):(x.value={booking_date:[],booking_text:[],booking_type:[],booking_amount:[],booking_date_parse_format:""},x.value)}const z=De({get:()=>o(),set:R=>{x.value=R,i.setMapping(R)}}),Q=De(()=>i.bankName.trim().length>0&&i.bookingAccount.trim().length>0&&i.header.length>0&&z.value.booking_date.length>0&&z.value.booking_amount.length>0);Ae(()=>i.bankName,R=>{const w=d.mappingByBank(R);w&&(i.setMapping({...w,booking_date_parse_format:w.booking_date_parse_format}),x.value=i.mapping)}),Ae(()=>i.mapping,R=>{R&&(x.value={...R})});async function le(R){await i.loadFile(R),!i.bankName&&i.detectedBank&&i.setBankName(i.detectedBank),x.value=i.mapping}async function ae(){!x.value||!i.bankName||await d.save({bank_name:i.bankName,...x.value})}async function ue(){if(!(!Q.value||!x.value)){S.value=!0,L.value=20;try{const R=i.importTransactions(u.resolvedSettings);L.value=60,await I.appendImported(R,{bankName:i.bankName,bookingAccount:i.bookingAccount}),L.value=100,v.value=`${R.length} Transaktionen importiert.`}catch(R){console.error("Import failed",R)}finally{setTimeout(()=>{S.value=!1,L.value=0},400)}}}return(R,w)=>(te(),se("div",Ot,[y("section",Tt,[y("div",Ft,[y("div",Bt,[w[6]||(w[6]=y("h2",{class:"text-lg font-semibold text-slate-900"},"CSV-Import",-1)),w[7]||(w[7]=y("p",{class:"mt-2 text-sm text-slate-600"},"Wählen Sie eine CSV-Datei und ordnen Sie die Spalten dem Zielschema zu.",-1)),y("div",Lt,[we(at,{onFileSelected:le}),y("div",null,[w[3]||(w[3]=y("label",{for:"bank",class:"block text-sm font-medium text-slate-700"},"Bankname",-1)),Oe(y("input",{id:"bank","onUpdate:modelValue":w[0]||(w[0]=H=>W(i).bankName=H),list:"knownBanks",type:"text",placeholder:"z. B. comdirect",class:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[Te,W(i).bankName]]),y("datalist",Mt,[(te(!0),se(Ge,null,Ye(W(d).knownBanks,H=>(te(),se("option",{key:H,value:H},null,8,zt))),128))])]),y("div",null,[w[4]||(w[4]=y("label",{for:"booking-account",class:"block text-sm font-medium text-slate-700"},"Buchungskonto",-1)),Oe(y("input",{id:"booking-account","onUpdate:modelValue":w[1]||(w[1]=H=>W(i).bookingAccount=H),type:"text",placeholder:"z. B. Girokonto",class:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500"},null,512),[[Te,W(i).bookingAccount]])]),W(i).detectedBank?(te(),se("p",Nt,[w[5]||(w[5]=Xe(" Erkannte Bank: ",-1)),y("span",jt,ce(W(i).detectedBank),1)])):pe("",!0),W(i).warning?(te(),se("p",Pt,ce(W(i).warning),1)):pe("",!0),W(i).error?(te(),se("p",Ut,ce(W(i).error),1)):pe("",!0)])]),W(i).header.length>0?(te(),se("div",Vt,[y("div",{class:"flex items-center justify-between"},[w[8]||(w[8]=y("h2",{class:"text-lg font-semibold text-slate-900"},"Mapping auf Zielschema",-1)),y("button",{type:"button",class:"inline-flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-500",onClick:ae}," Mapping speichern ")]),w[9]||(w[9]=y("p",{class:"mt-2 text-sm text-slate-600"}," Ordnen Sie die CSV-Spalten den Zielspalten zu. Bereits gespeicherte Mappings werden beim erneuten Import automatisch geladen. ",-1)),y("div",$t,[we(et,{headers:W(i).header,modelValue:z.value,"onUpdate:modelValue":w[2]||(w[2]=H=>z.value=H)},null,8,["headers","modelValue"])])])):pe("",!0)]),we(tt,{class:"lg:col-span-1",history:W(I).history,onRefresh:W(I).refreshHistory},null,8,["history","onRefresh"])]),y("section",qt,[y("div",Ht,[y("button",{type:"button",class:"inline-flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-indigo-500",disabled:!Q.value,onClick:ue}," Import starten ",8,Kt),v.value?(te(),se("span",Wt,ce(v.value),1)):pe("",!0)])]),we(ft,{visible:S.value,progress:L.value},null,8,["visible","progress"])]))}});export{Gt as default};
